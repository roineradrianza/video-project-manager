class ProjectVideo{constructor({project_id:e=null}){this.alert=!0,this.alert_type="",this.alert_message="",this.snackbar=!1,this.snackbar_timeout=3e3,this.snackbar_text="",this.dialog=!1,this.show_dialog=!1,this.loading=!1,this.edit_loading=!1,this.form=!0,this.endpoint="project-video",this.item={project_video_id:null,src:"",name:"",video:new File([],""),meta:{},project_id:e,created_at:"",updated_at:""},this.default={project_video_id:null,src:"",name:"",video:new File([],""),meta:{},project_id:e,created_at:"",updated_at:""},this.index=-1,this.items=[],this.video_players=[],this.load()}reset(){this.loading=!1,this.alert=!1,this.item=Object.assign({},this.default),this.index=-1}resetVideoPlayers(){Object.entries(videojs.players).forEach((e,t)=>{videojs.players[e[0]].dispose()}),this.video_players=[]}load(){let e=this;if(null==e.item.project_id)return!1;let t=api_url+`${e.endpoint}/get/${e.item.project_id}`;e.loading=!0,e.items=[],this.resetVideoPlayers(),Http.get(t).then(t=>{e.loading=!1,t.length>0&&(e.items=t)},t=>{e.response({type:"error"})}).then(()=>{e.items.forEach(t=>{e.renderVideoPlayer(t)})})}save(){let e=this;e.edit_loading=!0;let t=new FormData;if(Object.entries(e.item).forEach((e,i)=>{e[1]="meta"==e[0]?JSON.stringify(e[1]):e[1],t.append(e[0],e[1])}),e.index>=0){let t=api_url+`${e.endpoint}/update`;Http.put(t,e.item).then(t=>{e.response(t.status,t.message),"success"==t.status&&e.load(),e.dialog=!1,e.edit_loading=!1,e.reset()},t=>{e.response("error")})}else{let i=api_url+`${e.endpoint}/create`;Http.post(i,t).then(t=>(e.response(t.status,t.message),"success"==t.status&&(e.item.project_video_id=t.data.project_video_id,e.item.src=t.data.meta.src,e.item.meta=t.data.meta.meta,e.items.push(e.item)),e.dialog=!1,e.edit_loading=!1,e.item),t=>{e.response("error")}).then(t=>{t.hasOwnProperty("project_video_id")&&e.renderVideoPlayer(t)})}}renderVideoPlayer(e){let t=[{type:"video/mp4",src:e.meta.video_url_1080p,label:"1080p"},{type:"video/mp4",src:e.meta.video_url_720p,label:"720p",selected:!0},{type:"video/mp4",src:e.meta.video_url_480p,label:"480p"},{type:"video/mp4",src:e.meta.video_url_360p,label:"360p"},{type:"video/mp4",src:e.meta.video_url_240p,label:"240p"}],i=videojs("video_"+e.project_video_id,{fluid:!0,language:"es",sources:t,controlBar:{children:["playToggle","progressControl","volumePanel"]}});i.controlBar.addChild("QualitySelector");i.panorama({clickAndDrag:!0,PanoramaThumbnail:!0,KeyboardControl:!0,clickToToggle:!0,VREnable:!1,NoticeMessage:"",Notice:{Enable:!1}});this.video_players.push(i)}showItem(e){this.index=this.items.indexOf(e),this.item=Object.assign({},e),this.show_dialog=!0}editItem(e){this.index=this.items.indexOf(e),this.item=Object.assign({},e),this.dialog=!0}deleteItem(e){this.index=this.items.indexOf(e),this.item=Object.assign({},e),this.delete_dialog=!0}delete(){let e=this,t=api_url+`${e.endpoint}/delete/${e.item.project_video_id}`;Http.delete(t).then(t=>{e.response(t.status,t.message),"success"==t.status&&(e.load(),e.delete_dialog=!1),e.reset()},t=>{e.response("error")})}response(e="",t=""){this.loading=!1,this.alert=!0,this.alert_type=e,this.snackbar=!0,this.snackbar_timeout=3e3,this.alert_message,this.snackbar_text=t}}